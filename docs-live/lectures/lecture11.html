<!DOCTYPE html>
<html lang="en"><head>
<script src="../site_libs/clipboard/clipboard.min.js"></script>
<script src="../site_libs/quarto-html/tabby.min.js"></script>
<script src="../site_libs/quarto-html/popper.min.js"></script>
<script src="../site_libs/quarto-html/tippy.umd.min.js"></script>
<link href="../site_libs/quarto-html/tippy.css" rel="stylesheet">
<link href="../site_libs/quarto-html/light-border.css" rel="stylesheet">
<link href="../site_libs/quarto-html/quarto-syntax-highlighting-985aa47af68dae11cd4d235c71fb941e.css" rel="stylesheet" id="quarto-text-highlighting-styles"><meta charset="utf-8">
  <meta name="generator" content="quarto-1.7.27">

  <title>EGH445 Modern Control – lecture11</title>
  <meta name="apple-mobile-web-app-capable" content="yes">
  <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
  <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no, minimal-ui">
  <link rel="stylesheet" href="../site_libs/revealjs/dist/reset.css">
  <link rel="stylesheet" href="../site_libs/revealjs/dist/reveal.css">
  <style>
    code{white-space: pre-wrap;}
    span.smallcaps{font-variant: small-caps;}
    div.columns{display: flex; gap: min(4vw, 1.5em);}
    div.column{flex: auto; overflow-x: auto;}
    div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
    ul.task-list{list-style: none;}
    ul.task-list li input[type="checkbox"] {
      width: 0.8em;
      margin: 0 0.8em 0.2em -1em; /* quarto-specific, see https://github.com/quarto-dev/quarto-cli/issues/4556 */ 
      vertical-align: middle;
    }
    /* CSS for syntax highlighting */
    html { -webkit-text-size-adjust: 100%; }
    pre > code.sourceCode { white-space: pre; position: relative; }
    pre > code.sourceCode > span { display: inline-block; line-height: 1.25; }
    pre > code.sourceCode > span:empty { height: 1.2em; }
    .sourceCode { overflow: visible; }
    code.sourceCode > span { color: inherit; text-decoration: inherit; }
    div.sourceCode { margin: 1em 0; }
    pre.sourceCode { margin: 0; }
    @media screen {
    div.sourceCode { overflow: auto; }
    }
    @media print {
    pre > code.sourceCode { white-space: pre-wrap; }
    pre > code.sourceCode > span { text-indent: -5em; padding-left: 5em; }
    }
    pre.numberSource code
      { counter-reset: source-line 0; }
    pre.numberSource code > span
      { position: relative; left: -4em; counter-increment: source-line; }
    pre.numberSource code > span > a:first-child::before
      { content: counter(source-line);
        position: relative; left: -1em; text-align: right; vertical-align: baseline;
        border: none; display: inline-block;
        -webkit-touch-callout: none; -webkit-user-select: none;
        -khtml-user-select: none; -moz-user-select: none;
        -ms-user-select: none; user-select: none;
        padding: 0 4px; width: 4em;
        color: #aaaaaa;
      }
    pre.numberSource { margin-left: 3em; border-left: 1px solid #aaaaaa;  padding-left: 4px; }
    div.sourceCode
      { color: #003b4f; background-color: #f1f3f5; }
    @media screen {
    pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
    }
    code span { color: #003b4f; } /* Normal */
    code span.al { color: #ad0000; } /* Alert */
    code span.an { color: #5e5e5e; } /* Annotation */
    code span.at { color: #657422; } /* Attribute */
    code span.bn { color: #ad0000; } /* BaseN */
    code span.bu { } /* BuiltIn */
    code span.cf { color: #003b4f; font-weight: bold; } /* ControlFlow */
    code span.ch { color: #20794d; } /* Char */
    code span.cn { color: #8f5902; } /* Constant */
    code span.co { color: #5e5e5e; } /* Comment */
    code span.cv { color: #5e5e5e; font-style: italic; } /* CommentVar */
    code span.do { color: #5e5e5e; font-style: italic; } /* Documentation */
    code span.dt { color: #ad0000; } /* DataType */
    code span.dv { color: #ad0000; } /* DecVal */
    code span.er { color: #ad0000; } /* Error */
    code span.ex { } /* Extension */
    code span.fl { color: #ad0000; } /* Float */
    code span.fu { color: #4758ab; } /* Function */
    code span.im { color: #00769e; } /* Import */
    code span.in { color: #5e5e5e; } /* Information */
    code span.kw { color: #003b4f; font-weight: bold; } /* Keyword */
    code span.op { color: #5e5e5e; } /* Operator */
    code span.ot { color: #003b4f; } /* Other */
    code span.pp { color: #ad0000; } /* Preprocessor */
    code span.sc { color: #5e5e5e; } /* SpecialChar */
    code span.ss { color: #20794d; } /* SpecialString */
    code span.st { color: #20794d; } /* String */
    code span.va { color: #111111; } /* Variable */
    code span.vs { color: #20794d; } /* VerbatimString */
    code span.wa { color: #5e5e5e; font-style: italic; } /* Warning */
  </style>
  <link rel="stylesheet" href="../site_libs/revealjs/dist/theme/quarto-638f0ac56568416ec8caecb7e66c6a19.css">
  <script>window.backupDefine = window.define; window.define = undefined;</script><script src="https://cdn.jsdelivr.net/npm/katex@latest/dist/katex.min.js"></script>
  <script>document.addEventListener("DOMContentLoaded", function () {
 var mathElements = document.getElementsByClassName("math");
 var macros = [];
 for (var i = 0; i < mathElements.length; i++) {
  var texText = mathElements[i].firstChild;
  if (mathElements[i].tagName == "SPAN") {
   katex.render(texText.data, mathElements[i], {
    displayMode: mathElements[i].classList.contains('display'),
    throwOnError: false,
    macros: macros,
    fleqn: false
   });
}}});
  </script>
  <script>window.define = window.backupDefine; window.backupDefine = undefined;</script><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/katex@latest/dist/katex.min.css">
  <link href="../site_libs/revealjs/plugin/quarto-line-highlight/line-highlight.css" rel="stylesheet">
  <link href="../site_libs/revealjs/plugin/reveal-menu/menu.css" rel="stylesheet">
  <link href="../site_libs/revealjs/plugin/reveal-menu/quarto-menu.css" rel="stylesheet">
  <link href="../site_libs/revealjs/plugin/reveal-chalkboard/font-awesome/css/all.css" rel="stylesheet">
  <link href="../site_libs/revealjs/plugin/reveal-chalkboard/style.css" rel="stylesheet">
  <link href="../site_libs/revealjs/plugin/quarto-support/footer.css" rel="stylesheet">
  <style type="text/css">
    .reveal div.sourceCode {
      margin: 0;
      overflow: auto;
    }
    .reveal div.hanging-indent {
      margin-left: 1em;
      text-indent: -1em;
    }
    .reveal .slide:not(.center) {
      height: 100%;
      overflow-y: auto;
    }
    .reveal .slide.scrollable {
      overflow-y: auto;
    }
    .reveal .footnotes {
      height: 100%;
      overflow-y: auto;
    }
    .reveal .slide .absolute {
      position: absolute;
      display: block;
    }
    .reveal .footnotes ol {
      counter-reset: ol;
      list-style-type: none; 
      margin-left: 0;
    }
    .reveal .footnotes ol li:before {
      counter-increment: ol;
      content: counter(ol) ". "; 
    }
    .reveal .footnotes ol li > p:first-child {
      display: inline-block;
    }
    .reveal .slide ul,
    .reveal .slide ol {
      margin-bottom: 0.5em;
    }
    .reveal .slide ul li,
    .reveal .slide ol li {
      margin-top: 0.4em;
      margin-bottom: 0.2em;
    }
    .reveal .slide ul[role="tablist"] li {
      margin-bottom: 0;
    }
    .reveal .slide ul li > *:first-child,
    .reveal .slide ol li > *:first-child {
      margin-block-start: 0;
    }
    .reveal .slide ul li > *:last-child,
    .reveal .slide ol li > *:last-child {
      margin-block-end: 0;
    }
    .reveal .slide .columns:nth-child(3) {
      margin-block-start: 0.8em;
    }
    .reveal blockquote {
      box-shadow: none;
    }
    .reveal .tippy-content>* {
      margin-top: 0.2em;
      margin-bottom: 0.7em;
    }
    .reveal .tippy-content>*:last-child {
      margin-bottom: 0.2em;
    }
    .reveal .slide > img.stretch.quarto-figure-center,
    .reveal .slide > img.r-stretch.quarto-figure-center {
      display: block;
      margin-left: auto;
      margin-right: auto; 
    }
    .reveal .slide > img.stretch.quarto-figure-left,
    .reveal .slide > img.r-stretch.quarto-figure-left  {
      display: block;
      margin-left: 0;
      margin-right: auto; 
    }
    .reveal .slide > img.stretch.quarto-figure-right,
    .reveal .slide > img.r-stretch.quarto-figure-right  {
      display: block;
      margin-left: auto;
      margin-right: 0; 
    }
  </style>
  </head><body class="quarto-light"><div class="slide-header">

    <div class="main-header-content">

      <span id="header-left">Lecture Title</span> <span id="header-right">Section</span>      </div>

    <div class="sub-header-content" id="sub-header-container">

      <span id="sub-header-title">Slide Title</span> </div>

  </div>


  <div class="reveal">
    <div class="slides">


<section id="title-slide" class="slide level2 title-slide-custom center" data-state="titleslide">
<h2>Title Slide</h2>
<div class="logo-container-title">
<p><img src="../qut_logo.jpg" alt="QUT Logo"></p>
</div>
<div class="title-block">
<h1>
Practical Considerations
</h1>
<h2>
Observers and Output Feedback
</h2>
</div>
<div class="author-block-title">
<p>Dr Guilherme Froes Silva<br> School of Electrical Engineering &amp; Robotics<br> Queensland University of Technology</p>
</div>
<div class="course-code-title">
<p>EGH445 - Modern Control</p>
</div>
<!-- <div class="website-link-title">
  <a href="../index.html">
    Website
  </a>
</div> -->
<div class="contact-box-title">
<p>Consultation: GP-S1111<br> Email: g.froessilva@qut.edu.au</p>
</div>
</section>
<section id="overview" class="title-slide slide level1 center" data-state="overview">
<h1>Overview</h1>
<ul>
<li class="fragment">Quick recap: State-feedback control and estimation.</li>
<li class="fragment">Reality gap: Ideal models vs real-world implementation.</li>
<li class="fragment">Noise, constraints, hardware limits, model errors, etc.</li>
<li class="fragment">LQR and Kalman Filter tuning.</li>
<li class="fragment">Emulation design: digital controllers from continuous ones.</li>
<li class="fragment"><span class="fragment semi-fade-out">Implementation: hardware and software.</span></li>
</ul>
</section>

<section>
<section id="state-feedback-control-and-estimation" class="title-slide slide level1 center">
<h1>State-feedback control and estimation</h1>
<p>State vs Output Feedback Revisited</p>
</section>
<section id="state-vs-output-feedback-revisited" class="slide level2 smaller">
<h2>State vs Output Feedback Revisited</h2>
<p><em>When and why?</em> Consider the system <span class="math inline">x(kT+T) = Gx(kT) + Hu(kT)</span>, <span class="math inline">y(kT) = Cx(kT)</span>.</p>
<p><strong>System Matrix</strong> <span class="math inline">G = e^{AT}</span> represents the internal dynamics of the system.</p>
<ul>
<li class="fragment">It describes how the state <span class="math inline">x(kT)</span> evolves over time. Usually <em>inherent</em> to the system.</li>
</ul>
<p><strong>Input Matrix</strong> <span class="math inline">H = \int_0^T e^{A\tau}B d\tau</span> represents how the input <span class="math inline">u(kT)</span> affects the state <span class="math inline">x(kT)</span>.</p>
<ul>
<li class="fragment">Relates to the actuator(s) chosen (e.g.&nbsp;types of motors, heaters, valves, etc.).</li>
</ul>
<p><strong>Output Matrix</strong> <span class="math inline">C</span> represents how the states are measured as outputs <span class="math inline">y(kT)</span>.</p>
<ul>
<li class="fragment">Relates to the sensor(s) chosen (e.g.&nbsp;types and placement of sensors, cameras, etc.).</li>
</ul>
</section>
<section id="section" class="slide level2 smaller">
<h2></h2>
<div class="columns">
<div class="column" style="width:50%;">
<p><strong>State feedback: <span class="math inline">u(kT) = -Kx(kT)</span></strong></p>
<hr>
<ul>
<li class="fragment">System <span class="math inline">(G,H)</span> must be controllable.</li>
<li class="fragment">Closed-loop dynamics, <span class="math inline">G_{cl} = G - HK</span>.</li>
<li class="fragment">Assumes all states are available.
<ul>
<li class="fragment">Pole placement: <span class="math inline">K</span> gain.</li>
<li class="fragment">LQR: <span class="math inline">K</span> gain and cost function <span class="math inline">Q,R</span>.</li>
<li class="fragment">Integral action: Dynamic Extension and <span class="math inline">K_I</span> gain.</li>
</ul></li>
</ul>
</div><div class="column" style="width:50%;">
<p><strong>Output feedback: <span class="math inline">u(kT) = -K\hat{x}(kT)</span></strong></p>
<hr>
<ul>
<li class="fragment">System <span class="math inline">(G,C)</span> must be observable.</li>
<li class="fragment">Observer dynamics, <span class="math inline">G_{obs} = G - LC</span>.</li>
<li class="fragment">Used when only <span class="math inline">y(kT) = Cx(kT)</span> is available.
<ul>
<li class="fragment"><span class="math inline">y(kT)</span> is what is actually being measured.</li>
</ul></li>
<li class="fragment">Needs estimating <span class="math inline">\hat{x}(kT)</span> from <span class="math inline">y(kT)</span> and <span class="math inline">u(kT)</span>.
<ul>
<li class="fragment">Luenberger Observer - <span class="math inline">L</span> gain.</li>
<li class="fragment">Kalman Filter - <span class="math inline">K_k</span> gain and noise covariances.</li>
</ul></li>
</ul>
</div></div>
<ul>
<li class="fragment"><strong>Practical Question:</strong> When is it feasible/necessary to measure all states versus estimate them?
<ul>
<li class="fragment">Sensor cost and complexity (relates to <em>choice</em> of <span class="math inline">C</span>).</li>
<li class="fragment">Sensor availability (some states might be internal/unmeasurable).</li>
</ul></li>
</ul>
</section>
<section id="practical-trade-offs" class="slide level2 smaller">
<h2>Practical Trade-offs</h2>
<ul>
<li class="fragment"><strong>Observer Performance:</strong>
<ul>
<li class="fragment">Luenberger poles determine error convergence speed. Faster poles <span class="math inline">\rightarrow</span> potentially higher gain <span class="math inline">L</span>.</li>
<li class="fragment">Kalman Filter <em>dynamic</em> gain <span class="math inline">K_k</span> minimises the estimation error covariance iteratively, balancing model trust vs measurement trust based on noise characteristics <span class="math inline">(Q, R)</span>.</li>
</ul></li>
<li class="fragment"><strong>Noise Amplification:</strong>
<ul>
<li class="fragment">Large observer gains (<span class="math inline">L</span> or <span class="math inline">K_k</span>) can amplify measurement noise (<span class="math inline">v(kT)</span>), negatively impacting the control input <span class="math inline">u(kT) = -K\hat{x}(kT)</span>. There’s a trade-off: fast estimation vs noise sensitivity.</li>
</ul></li>
<li class="fragment"><strong>Computational Load:</strong>
<ul>
<li class="fragment">Observers add computational cost (matrix multiplications, additions).</li>
<li class="fragment">Increase in computational cost: Luenberger observers <span class="math inline">\rightarrow</span> Kalman filters <span class="math inline">\rightarrow</span> Extended Kalman filters (EKF).</li>
<li class="fragment">Needs to be feasible on the target hardware, considering the selected/needed sampling time <span class="math inline">T</span>.</li>
</ul></li>
</ul>
</section>
<section id="section-1" class="slide level2 smaller">
<h2></h2>
<ul>
<li class="fragment"><strong>Certainty Equivalence Principle:</strong>
<ul>
<li class="fragment">Recall: Controller <span class="math inline">(K)</span> and Observer <span class="math inline">(L)</span> can be designed independently. <!-- Closed-loop poles: $\{ \text{eig}(G-HK) \} \cup \{ \text{eig}(G-LC) \}$. --></li>
<li class="fragment">This holds perfectly <em>if the model is perfect</em>.</li>
<li class="fragment">Model mismatch can affect performance;
<ul>
<li class="fragment">Sometimes detuning the observer (slower poles) can improve robustness in practice.</li>
</ul></li>
</ul></li>
<li class="fragment"><strong>Discussion Point:</strong> Do the benefits of state estimation outweigh the costs?</li>
</ul>
<div class="columns">
<div class="column" style="width:50%;">
<p><strong>Benefits of State Estimation:</strong></p>
<hr>
<ul>
<li class="fragment">Handling unmeasured states</li>
<li class="fragment">Better performance via full state feedback</li>
</ul>
</div><div class="column" style="width:50%;">
<p><strong><em>Costs</em> of State Estimation:</strong></p>
<hr>
<ul>
<li class="fragment">Added complexity (and computational load)</li>
<li class="fragment">Need of tuning</li>
<li class="fragment">Sensitivity to noise</li>
<li class="fragment">Model mismatch</li>
</ul>
</div></div>
<p>Depends on the application!</p>
</section></section>
<section>
<section id="practical-considerations-lqr-design" class="title-slide slide level1 center">
<h1>Practical Considerations: <br> LQR Design</h1>
<ul>
<li class="fragment">LQR Fundamentals</li>
</ul>
</section>
<section id="recap-lqr-fundamentals" class="slide level2 smaller">
<h2>Recap: LQR Fundamentals</h2>
<ul>
<li class="fragment"><p><strong>Goal:</strong> Find <span class="math inline">u(kT) = -Kx(kT)</span> that minimises a quadratic cost function over an infinite horizon.</p></li>
<li class="fragment"><p><strong>Cost Function <span class="math inline">(J)</span>:</strong> Balances state regulation (<span class="math inline">Q</span>, state weighting) and control effort (<span class="math inline">R</span>, control weighting). <span class="math display">
  J = \sum_{k=0}^{\infty} \left( x(kT)^T Q x(kT) + u(kT)^T R u(kT) \right), \quad Q \succeq 0, \quad R \succ 0
  </span></p></li>
<li class="fragment"><p><strong>Solution:</strong> Solve the Discrete Algebraic Riccati Equation (DARE) for a unique, positive semi-definite matrix <span class="math inline">P</span>: <span class="math display">
  P = G^T P G - (G^T P H)(R + H^T P H)^{-1}(H^T P G) + Q
  </span> Then the gain is <span class="math inline">\; K = (R + H^T P H)^{-1} H^T P G.</span></p></li>
<li class="fragment"><p><strong>Stability:</strong> The closed-loop system <span class="math inline">x(kT+T) = (G-HK)x(kT)</span> is guaranteed to be stable if <span class="math inline">(G, H)</span> is controllable and <span class="math inline">(G, V)</span> is observable, where <span class="math inline">Q=V^T V</span>.</p></li>
</ul>
</section>
<section id="important-remark-on-g-v-observability" class="slide level2">
<h2>Important remark on (G, V) observability</h2>
<ul>
<li class="fragment">The matrix <span class="math inline">V</span> (from <span class="math inline">Q=V^T V</span>) defines which states or state combinations are <strong>penalised</strong> in the cost <span class="math inline">J</span>.</li>
<li class="fragment"><span class="math inline">(G, V)</span> observability ensures that any unstable behaviour will eventually affect the states penalised by <span class="math inline">Q</span>, forcing the controller to act.</li>
</ul>
<div class="callout callout-note callout-titled callout-style-default">
<div class="callout-body">
<div class="callout-title">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<p><strong>Analogy</strong></p>
</div>
<div class="callout-content">
<p><span class="math inline">C</span> describes the <em>outputs</em>, i.e.&nbsp;what states are <em>measured</em> (through physical sensors).</p>
<p><span class="math inline">V</span> describes what states are <em>penalised</em> (design choice in <span class="math inline">Q</span>).</p>
<p>Analogously to designing controllers assuming full state availability, <span class="math inline">V</span> and <span class="math inline">C</span> do not need to be the same.</p>
</div>
</div>
</div>
</section>
<section id="tuning-q-and-r-in-practice" class="slide level2 smaller">
<h2>Tuning Q and R in practice</h2>
<ul>
<li class="fragment"><strong>Starting Point: Diagonal Matrices</strong>
<ul>
<li class="fragment">Often start with diagonal <span class="math inline">Q</span> and <span class="math inline">R</span>.</li>
<li class="fragment"><span class="math inline">Q = \text{diag}(q_1, q_2, \dots, q_n)</span>: Penalises squared state deviations <span class="math inline">q_i x_i^2</span>.</li>
<li class="fragment"><span class="math inline">R = \text{diag}(r_1, r_2, \dots, r_m)</span>: Penalises squared control inputs <span class="math inline">r_j u_j^2</span>.</li>
</ul></li>
<li class="fragment"><strong>Relative Weights Matter:</strong>
<ul>
<li class="fragment">The absolute values of <span class="math inline">Q</span> and <span class="math inline">R</span> don’t matter as much as their <em>ratio</em>. Scaling both <span class="math inline">Q</span> and <span class="math inline">R</span> by the same factor results in the same gain <span class="math inline">K</span>.</li>
<li class="fragment">Common practice: Fix one element (e.g., <span class="math inline">R=1</span> or <span class="math inline">R=I</span>) and tune the elements of <span class="math inline">Q</span>.</li>
</ul></li>
<li class="fragment"><strong>Interpreting Weights:</strong>
<ul>
<li class="fragment">Larger <span class="math inline">q_i</span> means state <span class="math inline">x_i</span> is more important to regulate quickly/keep small.</li>
<li class="fragment">Larger <span class="math inline">r_j</span> means control input <span class="math inline">u_j</span> is more “expensive” (e.g., energy consumption, saturation limits).</li>
</ul></li>
</ul>
</section>
<section id="section-2" class="slide level2 smaller scrollable">
<h2></h2>
<ul>
<li class="fragment"><strong>Tuning Strategies:</strong>
<ul>
<li class="fragment"><strong>Bryson’s Rule (Rule of Thumb):</strong> Scale weights based on maximum acceptable deviations/inputs:
<ul>
<li class="fragment"><span class="math inline">q_{ii} \approx \frac{1}{(\text{max acceptable } x_i)^2}, \quad r_{jj} \approx \frac{1}{(\text{max acceptable } u_j)^2}</span></li>
</ul></li>
<li class="fragment"><strong>Trial and Error (Simulation/Experiment):</strong>
<ol type="1">
<li class="fragment">Simulate/run the system.</li>
<li class="fragment">Observe states <span class="math inline">x(kT)</span> and inputs <span class="math inline">u(kT)</span>.</li>
<li class="fragment">If states converge too slowly <span class="math inline">\rightarrow</span> Increase elements in <span class="math inline">Q</span> relative to <span class="math inline">R</span>.</li>
<li class="fragment">If control effort is too high/saturating <span class="math inline">\rightarrow</span> Increase elements in <span class="math inline">R</span> relative to <span class="math inline">Q</span>.</li>
</ol></li>
</ul></li>
<li class="fragment"><strong>Non-Diagonal Weights:</strong>
<ul>
<li class="fragment">Off-diagonal terms in <span class="math inline">Q</span> can penalise relationships between states (e.g., <span class="math inline">x_1 x_2</span>).</li>
<li class="fragment">Off-diagonal terms in <span class="math inline">R</span> can penalise simultaneous use of multiple actuators.</li>
<li class="fragment">Use only if there’s a clear physical reason; increases tuning complexity.</li>
</ul></li>
</ul>
</section>
<section id="lqr-limitations-revisited" class="slide level2 smaller">
<h2>LQR Limitations Revisited</h2>
<ul>
<li class="fragment"><strong>Model Accuracy:</strong>
<ul>
<li class="fragment">LQR performance relies on an accurate linear model (<span class="math inline">G, H</span>).</li>
<li class="fragment">Nonlinearities or parameter uncertainties can degrade performance or lead to instability.</li>
</ul></li>
<li class="fragment"><strong>Constraint Handling:</strong>
<ul>
<li class="fragment">Standard LQR formulation does <strong>not</strong> explicitly handle constraints on states (<span class="math inline">x</span>) or inputs (<span class="math inline">u</span>).</li>
<li class="fragment">Example: Actuator saturation (<span class="math inline">u_{min} \le u(kT) \le u_{max}</span>).</li>
<li class="fragment">Calculating gain <span class="math inline">K</span> and then saturating the control value can lead to poor performance or instability. <!-- * This is because the saturation introduces a nonlinearity not accounted for in the LQR design. --></li>
</ul></li>
<li class="fragment"><strong>Implicit Pole Placement:</strong>
<ul>
<li class="fragment">LQR <em>does</em> place closed-loop poles, but <em>indirectly</em> through the choice of <span class="math inline">Q</span> and <span class="math inline">R</span>.</li>
<li class="fragment">It’s hard to directly relate <span class="math inline">Q/R</span> choices to transient response characteristics (like %OS, <span class="math inline">t_s</span>).</li>
</ul></li>
<li class="fragment"><strong>Addressing Limitations:</strong> <!-- * For model uncertainty: Robust control techniques (beyond EGH445 scope). -->
<ul>
<li class="fragment">For constraints: Model Predictive Control (MPC) explicitly incorporates constraints in its optimization.</li>
</ul></li>
</ul>
</section></section>
<section>
<section id="practical-considerations-kalman-filter-design" class="title-slide slide level1 center">
<h1>Practical Considerations: <br> Kalman Filter Design</h1>
<div class="callout callout-important callout-titled callout-style-default">
<div class="callout-body">
<div class="callout-title">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<p><strong>Regarding assessment of this content</strong></p>
</div>
<div class="callout-content">
<p>You are not expected to know the mechanics/maths of a Kalman Filter implementation.</p>
<p>You <strong>are expected</strong> to know <em>what</em> it does, <em>why/when</em> it is useful, and <em>how</em> you tune it.</p>
</div>
</div>
</div>
</section>
<section id="recap-kf-fundamentals" class="slide level2 smaller scrollable">
<h2>Recap: KF Fundamentals</h2>
<p>Optimal state estimator for linear systems with <strong>Gaussian</strong> noise.</p>
<div class="columns">
<div class="column" style="width:50%;">
<ul>
<li class="fragment"><strong>System Model with Noise:</strong> <span class="math display">
  \begin{align*}
  {x}(kT+T) &amp;= G{x}(kT) + H{u}(kT) + {w}(kT) \\
  {y}(kT) &amp;= C{x}(kT) + {v}(kT)
  \end{align*}
  </span>
<ul>
<li class="fragment"><span class="math inline">{w}(kT)</span>: Process noise, <span class="math inline">Q = E[{w}{w}^T]</span></li>
<li class="fragment"><span class="math inline">{v}(kT)</span>: Measurement noise, <span class="math inline">R = E[{v}{v}^T]</span></li>
</ul></li>
</ul>
</div><div class="column" style="font-size: 0.8em;">
<ul>
<li class="fragment"><strong>Recursive Structure (Predict-Correct):</strong>
<ol type="1">
<li class="fragment"><strong>Predict:</strong> Project state estimate <span class="math inline">\hat{{x}}</span> and error covariance <span class="math inline">P</span> forward using the model (<span class="math inline">G, H, Q</span>).
<ul>
<li class="fragment"><span class="math inline">\hat{{x}}^-(kT) = G\hat{{x}}(kT-T) + H{u}(kT-T)</span></li>
<li class="fragment"><span class="math inline">P^-(kT) = G P(kT-T) G^T + Q_{k-1}</span></li>
</ul></li>
<li class="fragment"><strong>Correct (Update):</strong> Adjust prediction using the current measurement <span class="math inline">{y}(kT)</span> and the calculated Kalman Gain <span class="math inline">K_k</span>.
<ul>
<li class="fragment"><span class="math inline">K_k = P^-(kT) C^T (C P^-(kT) C^T + R)^{-1}</span></li>
<li class="fragment"><span class="math inline">\hat{{x}}(kT) = \hat{{x}}^-(kT) + K_k ({y}(kT) - C\hat{{x}}^-(kT))</span></li>
<li class="fragment"><span class="math inline">P(kT) = (I - K_k C) P^-(kT)</span></li>
</ul></li>
</ol></li>
</ul>
</div></div>
<div class="callout callout-note callout-titled callout-style-default">
<div class="callout-body">
<div class="callout-title">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<p><strong>Key Idea (watch Workshop 10 for a practical example)</strong></p>
</div>
<div class="callout-content">
<p><span class="math inline">K_k</span> optimally balances trusting the model prediction vs.&nbsp;trusting the noisy measurement based on the relative sizes of <span class="math inline">P^-(kT)</span>, <span class="math inline">Q</span>, and <span class="math inline">R</span>.</p>
</div>
</div>
</div>
</section>
<section id="the-tuning-challenge" class="slide level2 smaller">
<h2>The Tuning Challenge</h2>
<ul>
<li class="fragment"><p>“Optimal” performance relies on having the <strong>correct</strong> noise covariance matrices <span class="math inline">Q</span> and <span class="math inline">R</span>.</p>
<ul>
<li class="fragment"><span class="math inline">R</span> – sensor measurement <strong>uncertainty</strong> (variance).</li>
<li class="fragment"><span class="math inline">Q</span> – dynamics model <strong>uncertainty</strong> (variance) introduced by, unmodelled forces, discretisation errors, etc.</li>
</ul></li>
<li class="fragment"><p><strong>The Problem:</strong> In most real-world applications, the true values of <span class="math inline">Q</span> and <span class="math inline">R</span> are <strong>unknown</strong>.</p></li>
<li class="fragment"><p><strong>Consequence:</strong> Choosing incorrect <span class="math inline">Q</span> and <span class="math inline">R</span> leads to suboptimal state estimates.</p>
<ul>
<li class="fragment"><p>If the ratio <span class="math inline">Q/R</span> is too small, the filter will trust the model too much and ignore useful measurements.</p>
<p>Estimates converge slowly and <em>may drift</em>.</p></li>
<li class="fragment"><p>If the ratio <span class="math inline">Q/R</span> is too large, the filter will trust the measurements too much and ignore the models.</p>
<p>Estimates become noisy.</p></li>
</ul>
<p><!-- * If $R$ is too small (filter trusts measurements too much) $\rightarrow$ estimates become noisy.
  * If $R$ is too large (filter trusts measurements too little) $\rightarrow$ estimates converge slowly and ignore useful measurement information.
  * If $Q$ is too small (filter trusts the model too much) $\rightarrow$ estimates diverge if the model is inaccurate, slow to react to real changes.
  * If $Q$ is too large (filter trusts the model too little) $\rightarrow$ estimates become noisy, relying heavily on measurements. --></p></li>
<li class="fragment"><p><strong>Therefore:</strong> <span class="math inline">Q</span> and <span class="math inline">R</span> often become <strong>tuning parameters</strong> adjusted based on observed filter performance, rather than precisely known quantities.</p></li>
</ul>
</section>
<section id="tuning-strategies" class="slide level2 smaller">
<h2>Tuning Strategies</h2>
<div class="columns">
<div class="column" style="width:50%;">
<p><strong>Choosing <span class="math inline">R</span>:</strong></p>
<hr>
<p><span class="math inline">R \in \mathbb{R}^{p \times p}</span>, where <span class="math inline">p</span> is the number of outputs.</p>
<p>Often diagonal, when the sensor noise is uncorrelated.</p>
<p><span class="math display"> \scriptsize
R_k = \begin{bmatrix} \sigma_{v_1}^2 &amp; 0 &amp; \dots &amp; 0 \\ 0 &amp; \sigma_{v_2}^2 &amp; \dots &amp; 0 \\ \vdots &amp; \vdots &amp; \ddots &amp; \vdots \\ 0 &amp; 0 &amp; \dots &amp; \sigma_{v_p}^2 \end{bmatrix}
</span></p>
<p><strong>Determining values:</strong></p>
<ul>
<li class="fragment">Sensor datasheets: specified noise characteristics.</li>
<li class="fragment">Experimental data: calculated variance from samples.</li>
<li class="fragment">Cross-correlation: covariance between sensor signals.</li>
</ul>
</div><div class="column" style="width:50%;">
<p><strong>Choosing <span class="math inline">Q</span>:</strong></p>
<hr>
<p><span class="math inline">Q \in \mathbb{R}^{n \times n}</span>, where <span class="math inline">n</span> is the number of states.</p>
<p>Often diagonal and treated as a tuning parameter. <span class="math display"> \scriptsize
Q_k = \begin{bmatrix} \sigma_{w_1}^2 &amp; 0 &amp; \dots &amp; 0 \\ 0 &amp; \sigma_{w_2}^2 &amp; \dots &amp; 0 \\ \vdots &amp; \vdots &amp; \ddots &amp; \vdots \\ 0 &amp; 0 &amp; \dots &amp; \sigma_{w_n}^2 \end{bmatrix}
</span></p>
<p><strong>Determining values:</strong></p>
<ul>
<li class="fragment"><span class="math inline">\sigma_{w_i}^2</span> reflects how much <span class="math inline">x_i</span> is expected to deviate.</li>
<li class="fragment">Physical insight: deviation due real dynamics.</li>
<li class="fragment">Iterative tuning: <strong>observe residual</strong> <span class="math inline">e(kT)</span>.</li>
</ul>
</div></div>
</section>
<section id="kalman-filter-tuning-residual-analysis" class="slide level2 smaller scrollable">
<h2>Kalman Filter Tuning: Residual Analysis</h2>
<p>The <strong>residual</strong> is the difference between the <em>actual</em> measurement and the <em>predicted</em> measurement at each step: <span class="math display">
{e}(kT) = {y}(kT) - \hat{{y}}^-(kT) = {y}(kT) - C\hat{{x}}^-(kT)
</span></p>
<ul>
<li class="fragment"><strong>Theoretical Property:</strong> For a <em>perfectly modelled and optimally tuned</em> Kalman filter:
<ul>
<li class="fragment"><strong>Zero-mean:</strong> <span class="math inline">E[{e}(kT)] = 0</span>.</li>
<li class="fragment"><strong>White noise:</strong> Uncorrelated over time, <span class="math inline">E[{e}(kT){e}(jT)^T] = 0</span> for <span class="math inline">k \neq j</span>.</li>
<li class="fragment"><strong>Known Covariance:</strong> <span class="math inline">E[{e}(kT){e}(kT)^T] = C P^-(kT) C^T + R_k</span>.</li>
</ul></li>
<li class="fragment"><strong>Practical Use for Tuning:</strong>
<ol type="1">
<li class="fragment"><strong>Collect Residuals:</strong> Record <span class="math inline">{e}(kT)</span> over a representative run.</li>
<li class="fragment"><strong>Check Mean:</strong> If it’s significantly non-zero: bias in sensors or in the system model.</li>
<li class="fragment"><strong>Check Whiteness (Autocorrelation):</strong> Plot the autocorrelation function (ACF) of the residuals.</li>
</ol></li>
</ul>
<p>Adjust <span class="math inline">Q</span> and <span class="math inline">R</span> iteratively until the residuals “look like” zero-mean white noise with the expected covariance.</p>
</section></section>
<section>
<section id="emulation-design-digital-controllers-from-continuous-ones" class="title-slide slide level1 center">
<h1>Emulation Design: <br> Digital Controllers from Continuous Ones</h1>
<p>Discretising Continuous Controllers</p>
</section>
<section id="emulation-discretising-continuous-controllers" class="slide level2 smaller">
<h2>Emulation: Discretising Continuous Controllers</h2>
<p>Design a digital controller <span class="math inline">G_d(z)</span> that mimics the behaviour of a pre-designed continuous controller <span class="math inline">G_c(s)</span>.</p>
<div class="columns">
<div class="column">
<p><img data-src="images/lec11_c2d_controller.png"></p>
</div><div class="column">
<p><strong>Why Emulate?</strong></p>
<ul>
<li class="fragment">Leverage existing continuous controller designs.</li>
<li class="fragment">Control design is sometimes preferred in s-domain.</li>
<li class="fragment">Implement advanced continuous controllers digitally.</li>
</ul>
</div></div>
<div class="callout callout-note callout-titled callout-style-default">
<div class="callout-body">
<div class="callout-title">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<p><strong>Emulation vs.&nbsp;Direct Design</strong></p>
</div>
<div class="callout-content">
<ul>
<li class="fragment">Direct design: Discretise the plant, then design the controller directly (e.g., using DLQR)</li>
<li class="fragment">Emulation: Design the controller in the continuous domain (e.g., PID, Lead-Lag, LQR) and then discretise it.</li>
</ul>
</div>
</div>
</div>
</section>
<section id="discretisation-methods" class="slide level2 smaller">
<h2>Discretisation Methods</h2>
<p>How do we convert a continuous controller <span class="math inline">G_c(s)</span> into a discrete controller <span class="math inline">G_d(z)</span>?</p>
<p>There are three main methods.</p>
<h3 id="tustin-bilinear-transformation">1. Tustin (Bilinear) Transformation</h3>
<p>Uses a trapezoidal integration to get to a <em>bilinear</em> relation between <span class="math inline">s</span> and <span class="math inline">z</span> (opposed to <span class="math inline">s=\frac 1 T \ln{(z)}</span>).</p>
<h3 id="zero-order-hold-zoh-equivalence">2. Zero-Order Hold (ZOH) Equivalence</h3>
<p>Assumes the <strong>input to the controller</strong> <span class="math inline">e(t)</span> is held constant between samples by a ZOH <span class="math display">
e(kT+\tau) = e(kT) \text{ for } 0 \le \tau &lt; T
</span></p>
<h3 id="matched-pole-zero-mpz-method">3. Matched Pole-Zero (MPZ) Method</h3>
<p>Maps poles and zeros of <span class="math inline">G_c(s)</span>, in the s-plane, to those of <span class="math inline">G_d(z)</span>, in the z-plane, using <span class="math inline">z = e^{sT}</span>.</p>
</section>
<section id="tustin-bilinear-transform" class="slide level2 smaller">
<h2>Tustin (Bilinear) Transform</h2>
<p>Approximates the continuous-time integration operator <span class="math inline">1/s</span> with a discrete-time equivalent derived from the <strong>trapezoidal rule</strong> for numerical integration.</p>
<p><span class="math inline">u(kT) = \int e(t) dt \quad \rightarrow \quad u(kT) \approx u(kT-T) + \frac{T}{2}(e(kT) + e(kT-T))</span>.</p>
<p>Taking the z-transform of both sides gives: <span class="math display">
\begin{align*}
U(z) &amp;= z^{-1}U(z) + \frac{T}{2} \left( E(z) + z^{-1} E(z) \right) \\
\frac{U(z)}{E(z)} &amp;= \frac{T}{2} \frac{\left( 1 + z^{-1} \right)}{\left(1 - z^{-1}\right)} \\
\end{align*}
</span></p>
<div class="callout callout-note callout-titled callout-style-default">
<div class="callout-body">
<div class="callout-title">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<p><strong>Transformation Rule</strong></p>
</div>
<div class="callout-content">
<p>To convert <span class="math inline">G_c(s)</span> to <span class="math inline">G_d(z)</span>, substitute <span class="math inline">s</span> in <span class="math inline">G_c(s)</span> with: <span class="math display">
    s \leftarrow \frac{2}{T} \frac{z-1}{z+1}, \quad \text{that is, } \quad G_d(z) = G_c\left(\frac{2}{T} \frac{z-1}{z+1}\right).
    </span></p>
</div>
</div>
</div>
</section>
<section id="tustin-bilinear-transform-properties" class="slide level2">
<h2>Tustin (Bilinear) Transform Properties</h2>
<ul>
<li class="fragment">Maps the left-half of the s-plane entirely into the unit circle in the z-plane.</li>
<li class="fragment">Maps the <span class="math inline">j\omega</span> axis of the s-plane onto the unit circle <span class="math inline">|z|=1</span> in the z-plane.</li>
<li class="fragment">This preserves stability: a stable <span class="math inline">G_c(s)</span> will result in a stable <span class="math inline">G_d(z)</span>.</li>
</ul>
<!-- * **Frequency Warping:**
    * There is a nonlinear relationship between the continuous frequency $\omega$ and the discrete frequency $\Omega T$: $\omega_d T = 2 \arctan(\frac{\omega T}{2})$.
    * This means the frequency response of $G_D(z)$ can be a "warped" version of $G_c(s)$'s frequency response, especially at higher frequencies relative to the sampling rate.
    * **Pre-warping:** If matching the frequency response at a critical frequency $\omega_c$ is important, the $s$-domain controller can be "pre-warped" before Tustin transformation. (Usually not detailed in an introductory context unless critical). -->
<p><strong>MATLAB</strong>: <code>c2d(Gc, T, 'tustin')</code>.</p>
<p><strong>Python</strong>: <code>scipy.signal.cont2discrete(Gc, dt=T, method='bilinear')</code>.</p>
</section>
<section id="zero-order-hold-zoh-equivalence-1" class="slide level2 smaller">
<h2>Zero-Order Hold (ZOH) Equivalence</h2>
<p>Assumes the input <span class="math inline">e(t)</span> to the controller is held constant by a Zero-Order Hold (ZOH) for one sampling period <span class="math inline">T</span>.</p>
<ul>
<li class="fragment">The sampler and ZOH are placed before the continuous controller <span class="math inline">G_c(s)</span>.</li>
<li class="fragment">The continuous controller sees a staircase input <span class="math inline">e(t) = e(kT)</span> for <span class="math inline">kT \le t &lt; kT+T</span>.</li>
<li class="fragment">The result is z-transformed to get the discrete controller <span class="math inline">G_d(z)</span>.</li>
</ul>
<p><strong>ZOH Transfer Function:</strong> <span class="math inline">G_{zoh}(s) = \frac{1}{s} (1 - e^{-sT})</span>. Positive step at <span class="math inline">kT</span> minus negative step at <span class="math inline">kT+T</span>.</p>
<div class="callout callout-note callout-titled callout-style-default">
<div class="callout-body">
<div class="callout-title">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<p><strong>Transformation Rule</strong></p>
</div>
<div class="callout-content">
<p>The pulse transfer function <span class="math inline">G_d(z)</span> of the discretised controller is given by:</p>
<div class="columns">
<div class="column">
<p><span class="math display">
G_d(z) = \mathcal{Z}\left\{ \mathcal{L}^{-1}\left[ \frac{1-e^{-sT}}{s} G_c(s) \right] \right\} = (1-z^{-1}) \mathcal{Z}\left\{\frac{G_c(s)}{s}\right\}
</span></p>
</div><div class="column">
<div id="3f6bc219" class="cell" data-execution_count="1">
<div class="cell-output cell-output-display" data-execution_count="1">
<div class="quarto-figure quarto-figure-center">
<figure>
<p><img data-src="lecture11_files/figure-revealjs/cell-2-output-1.svg" class="quarto-figure quarto-figure-center"></p>
</figure>
</div>
</div>
</div>
</div></div>
</div>
</div>
</div>
</section>
<section id="zoh-equivalence-properties" class="slide level2">
<h2>ZOH Equivalence Properties</h2>
<ul>
<li class="fragment">The ZOH method exactly matches the response of the continuous and discrete systems <em>at the sampling instants</em> if the input to <span class="math inline">G_c(s)</span> were indeed staircase (due to the ZOH).</li>
<li class="fragment">Stability is preserved if <span class="math inline">G_c(s)</span> is stable.</li>
</ul>
<p><strong>MATLAB</strong>: <code>c2d(Gc, T, 'zoh')</code>.</p>
<p><strong>Python</strong>: <code>scipy.signal.cont2discrete(Gc, dt=T, method='zoh')</code>.</p>
</section>
<section id="matched-pole-zero-mpz-method-1" class="slide level2 smaller">
<h2>Matched Pole-Zero (MPZ) Method</h2>
<p>Preserves the locations of poles/zeros by mapping them directly using the fundamental relationship <span class="math inline">z = e^{sT}</span>.</p>
<p><strong>1. Map Poles and Zeros:</strong></p>
<ul>
<li class="fragment">Map poles and zeros of <span class="math inline">G_c(s)</span> to poles and zeros of <span class="math inline">G_d(z)</span> using the relationship <span class="math inline">z = e^{s T}</span>.</li>
<li class="fragment">Form the basic structure: <span class="math inline">G_d(z) = K_d \frac{\prod (z - z_{z_j})}{\prod (z - z_{p_i})}</span>.</li>
</ul>
<p><strong>2. Adjust Numerator Order (Add Zeros at <span class="math inline">z=-1</span>):</strong></p>
<ul>
<li class="fragment">To match phase characteristics, zeros at <span class="math inline">z=-1</span> (Nyquist frequency) are added to the numerator until its order is equal to or one less than the denominator’s order.</li>
<li class="fragment">This helps average/smooth the input, similar to Tustin’s trapezoidal rule effect.</li>
</ul>
<p><strong>3. Match DC Gain:</strong></p>
<ul>
<li class="fragment">Adjust <span class="math inline">K_d</span> so that the DC gain of <span class="math inline">G_d(z)</span> (at <span class="math inline">z=1</span>) matches the DC gain of <span class="math inline">G_c(s)</span> (at <span class="math inline">s=0</span>).</li>
</ul>
</section>
<section id="matched-pole-zero-method-properties" class="slide level2 smaller">
<h2>Matched Pole-Zero Method: Properties</h2>
<p><strong>Stability Preservation:</strong></p>
<ul>
<li class="fragment">The poles are mapped such that <span class="math inline">|z| = |e^{sT}| = e^{Re(s)T} &lt; 1</span>, preserving the stability of <span class="math inline">G_c(s)</span>.</li>
</ul>
<p><strong>Frequency Response:</strong></p>
<ul>
<li class="fragment">The matching of DC gain ensures that the low-frequency response of <span class="math inline">G_d(z)</span> is similar to <span class="math inline">G_c(s)</span>.</li>
</ul>
<!-- * The mapping $z=e^{sT}$ relates the continuous frequency $\omega$ to the discrete frequency $\Omega$ by $\Omega T = \omega T$. This means there's no frequency warping of the pole/zero locations themselves, unlike Tustin. -->
<!-- * However, the overall frequency response can still differ from $G_c(s)$, especially at higher frequencies, due to:
    * The finite number of poles/zeros being matched.
    * The addition of zeros at $z=-1$ (Nyquist frequency), which primarily affects the high-frequency phase and gain. These zeros can sometimes introduce oscillatory behaviour if not carefully considered or if the sampling rate is too low. -->
<!-- * **Relative Degree:**
    * The process of adding zeros at $z=-1$ aims to make the relative degree (difference between pole count and zero count) of $G_d(z)$ similar to that of $G_c(s)$ or to achieve a specific roll-off characteristic. -->
<ul>
<li class="fragment"><strong>Comparison to Other Methods:</strong>
<ul>
<li class="fragment"><strong>Tustin:</strong> Generally better overall frequency response approximation. <!-- (especially with pre-warping) but introduces frequency warping. --></li>
<li class="fragment"><strong>ZOH:</strong> Exact at sampling instants <em>if the input is staircase</em>. Can introduce phase lag.</li>
<li class="fragment"><strong>MPZ:</strong> Good for preserving specific pole/zero locations and DC gain. Often used when the locations of dominant poles/zeros are critical. <!-- The behaviour at high frequencies can be more variable depending on the original system and the added zeros. --></li>
</ul></li>
</ul>
<p><strong><code>MATLAB</code></strong> function: <code>c2d(Gc, T, 'matched')</code> or <code>c2d(Gc, T, 'mpz')</code>.</p>
<p><strong><code>Python</code></strong> function: <code>control.TransferFunction(num, den).sample(T, 'matched')</code>.</p>
</section>
<section id="example-discretising-a-continuous-controller" class="slide level2 smaller">
<h2>Example: Discretising a Continuous Controller</h2>
<div class="columns">
<div class="column" style="width:50%;">
<p><strong>Continuous-Time System (Mass-Spring-Damper):</strong></p>
<ul>
<li class="fragment">State-space model: <span class="math display">
  \begin{align*} \dot{x} &amp;= \begin{bmatrix} 0 &amp; 1 \\ -1 &amp; -2 \end{bmatrix} x(t) + \begin{bmatrix} 0 \\ 1 \end{bmatrix} u(t) \\ y(t) &amp;= \begin{bmatrix} 1 &amp; 0 \end{bmatrix} x(t) \end{align*}
  </span></li>
</ul>
</div><div class="column" style="width:50%;">
<p><strong>Continuous-Time Lead Controller <span class="math inline">G_c(s)</span>:</strong> <span class="math display">
    G_c(s) = K \frac{s+a}{s+b} = 2.8 \frac{s+2}{s+4}
    </span> Pre-designed controller for the continuous system.</p>
<p><strong>Task:</strong> Find the discrete-time controller <span class="math inline">G_d(z)</span></p>
</div></div>

<img data-src="images/lec11_simulink.png" class="quarto-figure quarto-figure-center r-stretch"></section>
<section id="section-3" class="slide level2 smaller scrollable">
<h2></h2>
<ul>
<li class="fragment"><strong>Task:</strong> Find the equivalent discrete-time controller <span class="math inline">G_d(z)</span> using:
<ol type="1">
<li class="fragment">Tustin (Bilinear) Transform</li>
<li class="fragment">Zero-Order Hold (ZOH) Equivalence</li>
<li class="fragment">Matched Pole-Zero (MPZ) Method</li>
</ol></li>
<li class="fragment">We will consider two sampling times:
<ul>
<li class="fragment">Part A: <span class="math inline">T = 1.0</span> second</li>
<li class="fragment">Part B: <span class="math inline">T = 0.1</span> second</li>
</ul></li>
</ul>
<div class="fragment">
<p>And compare their performance when controlling the continuous plant.</p>
</div>
</section>
<section id="example-part-a-tustin-method-t1.0s" class="slide level2 smaller scrollable">
<h2>Example Part A: Tustin Method (T=1.0s)</h2>
<ul>
<li class="fragment"><p><strong>Continuous Lead Controller:</strong> <span class="math inline">G_c(s) = 2.8 \frac{s+2}{s+4}</span></p></li>
<li class="fragment"><p><strong>Sampling Time:</strong> <span class="math inline">T=1.0</span> second.</p></li>
<li class="fragment"><p><strong>Tustin Transformation Rule:</strong> Substitute <span class="math inline">s \leftarrow \frac{2}{T}\frac{z-1}{z+1} = \frac{2(z-1)}{z+1}</span> (since <span class="math inline">T=1</span>) into <span class="math inline">G_c(s)</span>.</p>
<p><span class="math display">
  \begin{align*} G_d(z) &amp;= 2.8 \left( \frac{ \frac{2(z-1)}{z+1} + 2 }{ \frac{2(z-1)}{z+1} + 4 } \right) \\ &amp;= 2.8 \left( \frac{ 2(z-1) + 2(z+1) }{ 2(z-1) + 4(z+1) } \right) \quad \text{(Multiply num/den by }(z+1)\text{)} \\ &amp;= 2.8 \left( \frac{ 2z - 2 + 2z + 2 }{ 2z - 2 + 4z + 4 } \right) \\ &amp;= 2.8 \left( \frac{ 4z }{ 6z + 2 } \right) = 2.8 \left( \frac{ 2z }{ 3z + 1 } \right)= \frac{5.6z}{3z+1} = \frac{1.8667z}{z+0.3333} \end{align*}
  </span></p></li>
</ul>
<div class="fragment">
<p><strong>MATLAB Implementation</strong></p>
<div class="columns">
<div class="column">
<div class="sourceCode" id="cb1"><pre class="sourceCode numberSource matlab number-lines code-with-copy"><code class="sourceCode matlab"><span id="cb1-1"><a></a><span class="co">% MATLAB Code Snippet</span></span>
<span id="cb1-2"><a></a><span class="va">K_c</span> <span class="op">=</span> <span class="fl">2.8</span><span class="op">;</span></span>
<span id="cb1-3"><a></a><span class="va">Gc_s</span> <span class="op">=</span> <span class="va">tf</span>(<span class="va">K_c</span><span class="op">*</span>[<span class="fl">1</span> <span class="fl">2</span>]<span class="op">,</span> [<span class="fl">1</span> <span class="fl">4</span>])<span class="op">;</span></span>
<span id="cb1-4"><a></a><span class="va">T</span> <span class="op">=</span> <span class="fl">1.0</span><span class="op">;</span></span>
<span id="cb1-5"><a></a><span class="va">Gd_tustin</span> <span class="op">=</span> <span class="va">c2d</span>(<span class="va">Gc_s</span><span class="op">,</span> <span class="va">T</span><span class="op">,</span> <span class="ss">'tustin'</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div><div class="column">
<pre><code>   1.867 z
  ----------
  z + 0.3333</code></pre>
</div></div>
<div class="columns vcenter-cols">
<div class="column" style="width:70%;">
<div class="quarto-figure quarto-figure-center">
<figure>
<p><img data-src="images/lec11_tustin1.png" class="quarto-figure quarto-figure-center"></p>
</figure>
</div>
</div><div class="column" style="width:30%;">
<ul>
<li class="fragment">Stable</li>
<li class="fragment">Poor performance</li>
</ul>
</div></div>
</div>
</section>
<section id="example-part-a-zoh-method-t1.0s" class="slide level2 smaller scrollable">
<h2>Example Part A: ZOH Method (T=1.0s)</h2>
<ul>
<li class="fragment"><p><strong>Continuous Lead Controller:</strong> <span class="math inline">G_c(s) = 2.8 \frac{s+2}{s+4}</span></p></li>
<li class="fragment"><p><strong>Sampling Time:</strong> <span class="math inline">T=1.0</span> second.</p></li>
<li class="fragment"><p><strong>ZOH Transformation Rule:</strong> <span class="math inline">G_d(z) = (1-z^{-1}) \mathcal{Z}\left\{\frac{G_c(s)}{s}\right\}</span></p></li>
<li class="fragment"><p><strong>Step 1: Find <span class="math inline">\frac{G_c(s)}{s}</span></strong> <span class="math display">
  \frac{G_c(s)}{s} = 2.8 \frac{s+2}{s(s+4)}
  </span> Using partial fraction expansion: <span class="math display">
  \frac{s+2}{s(s+4)} = \frac{A}{s} + \frac{B}{s+4} = \frac{0.5}{s} + \frac{0.5}{s+4}
  </span> So, <span class="math inline">\frac{G_c(s)}{s} = 2.8 \left( \frac{0.5}{s} + \frac{0.5}{s+4} \right) = \frac{1.4}{s} + \frac{1.4}{s+4}</span>.</p></li>
</ul>
<div class="fragment">
<ul>
<li class="fragment"><strong>Step 2: Find <span class="math inline">\mathcal{Z}\left\{\frac{G_c(s)}{s}\right\}</span></strong>
<ul>
<li class="fragment"><span class="math inline">\mathcal{Z}\left\{\frac{1.4}{s}\right\} = 1.4 \frac{z}{z-1}</span></li>
<li class="fragment"><span class="math inline">\mathcal{Z}\left\{\frac{1.4}{s+4}\right\} = 1.4 \frac{z}{z-e^{-4T}} = 1.4 \frac{z}{z-e^{-4}}</span> (since <span class="math inline">T=1</span>)</li>
<li class="fragment">So, <span class="math inline">\mathcal{Z}\left\{\frac{G_c(s)}{s}\right\} = 1.4 \left( \frac{z}{z-1} + \frac{z}{z-e^{-4}} \right)</span>.</li>
</ul></li>
<li class="fragment"><strong>Step 3: Calculate <span class="math inline">G_d(z)</span></strong> <span class="math display">
  \begin{align*} G_d(z) &amp;= \frac{z-1}{z} \cdot 1.4 \left( \frac{z}{z-1} + \frac{z}{z-e^{-4}} \right) \\ &amp;= 1.4 \left( 1 + \frac{z-1}{z-e^{-4}} \right) = 1.4 \left( \frac{z-e^{-4} + z-1}{z-e^{-4}} \right) \\ &amp;= 1.4 \frac{2z - (1+e^{-4})}{z-e^{-4}}
  = \frac{2.8z - 1.4256}{z - 0.0183}
  \end{align*}
  </span></li>
</ul>
</div>
<div class="fragment">
<div class="columns vcenter-cols">
<div class="column" style="width:70%;">
<div class="quarto-figure quarto-figure-center">
<figure>
<p><img data-src="images/lec11_zoh1.png" class="quarto-figure quarto-figure-center"></p>
</figure>
</div>
</div><div class="column" style="width:30%;">
<ul>
<li class="fragment">Marginally stable</li>
<li class="fragment">Oscillatory behaviour</li>
</ul>
</div></div>
</div>
</section>
<section id="example-part-a-mpz-method-t1.0s" class="slide level2 smaller scrollable">
<h2>Example Part A: MPZ Method (T=1.0s)</h2>
<ul>
<li class="fragment"><strong>Continuous Lead Controller:</strong> <span class="math inline">G_c(s) = 2.8 \frac{s+2}{s+4}</span></li>
<li class="fragment"><strong>Sampling Time:</strong> <span class="math inline">T=1.0</span> second.</li>
</ul>
<ol type="1">
<li class="fragment"><strong>Map Poles and Zeros</strong>:
<ul>
<li class="fragment">Zero of <span class="math inline">G_c(s)</span>: <span class="math inline">s_z = -2 \implies z_z = e^{-2T} = e^{-2} \approx 0.1353</span>.</li>
<li class="fragment">Pole of <span class="math inline">G_c(s)</span>: <span class="math inline">s_p = -4 \implies z_p = e^{-4T} = e^{-4} \approx 0.0183</span>.</li>
<li class="fragment">Basic structure: <span class="math inline">G_d(z) = K_d' \frac{z - e^{-2}}{z - e^{-4}}</span>.</li>
</ul></li>
<li class="fragment"><strong>Adjust Numerator Order:</strong>
<ul>
<li class="fragment">The numerator and denominator are already of the same order (both first order). No additional zeros at <span class="math inline">z=-1</span> are needed in this case.</li>
</ul></li>
</ol>
<div class="fragment">
<ol start="3" type="1">
<li class="fragment"><strong>Match DC Gain</strong>:
<ul>
<li class="fragment">DC gain of <span class="math inline">G_c(s)</span>: <span class="math inline">\lim_{s \to 0} 2.8 \frac{s+2}{s+4} = 2.8 \frac{2}{4} = 1.4</span>.</li>
<li class="fragment">DC gain of <span class="math inline">G_d(z)</span>: <span class="math inline">\lim_{z \to 1} K_d' \frac{z - e^{-2}}{z - e^{-4}} = K_d' \frac{1 - e^{-2}}{1 - e^{-4}}</span>.</li>
<li class="fragment">Equating: <span class="math inline">K_d' \frac{1 - e^{-2}}{1 - e^{-4}} = 1.4</span>.</li>
<li class="fragment"><span class="math inline">K_d' = 1.4 \frac{1 - e^{-4}}{1 - e^{-2}} = 1.4 \frac{1 - 0.018316}{1 - 0.135335} \approx 1.5895</span>.</li>
<li class="fragment">So, <span class="math inline">G_d(z) = 1.5895 \frac{z - 0.1353}{z - 0.0183} = \frac{1.5895z - 0.2151}{z - 0.0183}</span>.</li>
</ul></li>
</ol>
</div>
<div class="fragment">
<div class="columns vcenter-cols">
<div class="column" style="width:70%;">
<div class="quarto-figure quarto-figure-center">
<figure>
<p><img data-src="images/lec11_mpz1.png" class="quarto-figure quarto-figure-center"></p>
</figure>
</div>
</div><div class="column" style="width:30%;">
<ul>
<li class="fragment">Stable</li>
<li class="fragment">Poor performance</li>
</ul>
</div></div>
</div>
</section>
<section id="comparison-t1.0s-and-t0.1s" class="slide level2 smaller">
<h2>Comparison T=1.0s and T=0.1s</h2>
<div class="columns">
<div class="column">
<p><img data-src="images/lec11_all1.png"></p>
</div><div class="column">
<p><img data-src="images/lec11_all01.png"></p>
</div></div>
<div class="fragment">
<div style="text-align: right;">
<p>Thank you.</p>
</div>


</div>
</section></section>
    </div>
  <div class="quarto-auto-generated-content" style="display: none;">
<div class="footer footer-default">

</div>
</div></div>

  <script>window.backupDefine = window.define; window.define = undefined;</script>
  <script src="../site_libs/revealjs/dist/reveal.js"></script>
  <!-- reveal.js plugins -->
  <script src="../site_libs/revealjs/plugin/quarto-line-highlight/line-highlight.js"></script>
  <script src="../site_libs/revealjs/plugin/pdf-export/pdfexport.js"></script>
  <script src="../site_libs/revealjs/plugin/reveal-menu/menu.js"></script>
  <script src="../site_libs/revealjs/plugin/reveal-menu/quarto-menu.js"></script>
  <script src="../site_libs/revealjs/plugin/reveal-chalkboard/plugin.js"></script>
  <script src="../site_libs/revealjs/plugin/quarto-support/support.js"></script>
  

  <script src="../site_libs/revealjs/plugin/notes/notes.js"></script>
  <script src="../site_libs/revealjs/plugin/search/search.js"></script>
  <script src="../site_libs/revealjs/plugin/zoom/zoom.js"></script>
  <script>window.define = window.backupDefine; window.backupDefine = undefined;</script>

  <script>

      // Full list of configuration options available at:
      // https://revealjs.com/config/
      Reveal.initialize({
'controlsAuto': true,
'previewLinksAuto': false,
'pdfSeparateFragments': false,
'autoAnimateEasing': "ease",
'autoAnimateDuration': 1,
'autoAnimateUnmatched': true,
'jumpToSlide': true,
'menu': {"side":"left","useTextContentForMissingTitles":true,"markers":false,"loadIcons":false,"custom":[{"title":"Tools","icon":"<i class=\"fas fa-gear\"></i>","content":"<ul class=\"slide-menu-items\">\n<li class=\"slide-tool-item active\" data-item=\"0\"><a href=\"#\" onclick=\"RevealMenuToolHandlers.fullscreen(event)\"><kbd>f</kbd> Fullscreen</a></li>\n<li class=\"slide-tool-item\" data-item=\"1\"><a href=\"#\" onclick=\"RevealMenuToolHandlers.speakerMode(event)\"><kbd>s</kbd> Speaker View</a></li>\n<li class=\"slide-tool-item\" data-item=\"2\"><a href=\"#\" onclick=\"RevealMenuToolHandlers.overview(event)\"><kbd>o</kbd> Slide Overview</a></li>\n<li class=\"slide-tool-item\" data-item=\"3\"><a href=\"#\" onclick=\"RevealMenuToolHandlers.togglePdfExport(event)\"><kbd>e</kbd> PDF Export Mode</a></li>\n<li class=\"slide-tool-item\" data-item=\"4\"><a href=\"#\" onclick=\"RevealMenuToolHandlers.toggleScrollView(event)\"><kbd>r</kbd> Scroll View Mode</a></li>\n<li class=\"slide-tool-item\" data-item=\"5\"><a href=\"#\" onclick=\"RevealMenuToolHandlers.toggleChalkboard(event)\"><kbd>b</kbd> Toggle Chalkboard</a></li>\n<li class=\"slide-tool-item\" data-item=\"6\"><a href=\"#\" onclick=\"RevealMenuToolHandlers.toggleNotesCanvas(event)\"><kbd>c</kbd> Toggle Notes Canvas</a></li>\n<li class=\"slide-tool-item\" data-item=\"7\"><a href=\"#\" onclick=\"RevealMenuToolHandlers.downloadDrawings(event)\"><kbd>d</kbd> Download Drawings</a></li>\n<li class=\"slide-tool-item\" data-item=\"8\"><a href=\"#\" onclick=\"RevealMenuToolHandlers.keyboardHelp(event)\"><kbd>?</kbd> Keyboard Help</a></li>\n</ul>"}],"openButton":true},
'chalkboard': {"buttons":true},
'smaller': false,
 
        // Display controls in the bottom right corner
        controls: false,

        // Help the user learn the controls by providing hints, for example by
        // bouncing the down arrow when they first encounter a vertical slide
        controlsTutorial: false,

        // Determines where controls appear, "edges" or "bottom-right"
        controlsLayout: 'edges',

        // Visibility rule for backwards navigation arrows; "faded", "hidden"
        // or "visible"
        controlsBackArrows: 'faded',

        // Display a presentation progress bar
        progress: true,

        // Display the page number of the current slide
        slideNumber: 'c/t',

        // 'all', 'print', or 'speaker'
        showSlideNumber: 'all',

        // Add the current slide number to the URL hash so that reloading the
        // page/copying the URL will return you to the same slide
        hash: true,

        // Start with 1 for the hash rather than 0
        hashOneBasedIndex: false,

        // Flags if we should monitor the hash and change slides accordingly
        respondToHashChanges: true,

        // Push each slide change to the browser history
        history: true,

        // Enable keyboard shortcuts for navigation
        keyboard: true,

        // Enable the slide overview mode
        overview: true,

        // Disables the default reveal.js slide layout (scaling and centering)
        // so that you can use custom CSS layout
        disableLayout: false,

        // Vertical centering of slides
        center: false,

        // Enables touch navigation on devices with touch input
        touch: true,

        // Loop the presentation
        loop: false,

        // Change the presentation direction to be RTL
        rtl: false,

        // see https://revealjs.com/vertical-slides/#navigation-mode
        navigationMode: 'linear',

        // Randomizes the order of slides each time the presentation loads
        shuffle: false,

        // Turns fragments on and off globally
        fragments: true,

        // Flags whether to include the current fragment in the URL,
        // so that reloading brings you to the same fragment position
        fragmentInURL: false,

        // Flags if the presentation is running in an embedded mode,
        // i.e. contained within a limited portion of the screen
        embedded: false,

        // Flags if we should show a help overlay when the questionmark
        // key is pressed
        help: true,

        // Flags if it should be possible to pause the presentation (blackout)
        pause: true,

        // Flags if speaker notes should be visible to all viewers
        showNotes: false,

        // Global override for autoplaying embedded media (null/true/false)
        autoPlayMedia: null,

        // Global override for preloading lazy-loaded iframes (null/true/false)
        preloadIframes: null,

        // Number of milliseconds between automatically proceeding to the
        // next slide, disabled when set to 0, this value can be overwritten
        // by using a data-autoslide attribute on your slides
        autoSlide: 0,

        // Stop auto-sliding after user input
        autoSlideStoppable: true,

        // Use this method for navigation when auto-sliding
        autoSlideMethod: null,

        // Specify the average time in seconds that you think you will spend
        // presenting each slide. This is used to show a pacing timer in the
        // speaker view
        defaultTiming: null,

        // Enable slide navigation via mouse wheel
        mouseWheel: false,

        // The display mode that will be used to show slides
        display: 'block',

        // Hide cursor if inactive
        hideInactiveCursor: true,

        // Time before the cursor is hidden (in ms)
        hideCursorTime: 5000,

        // Opens links in an iframe preview overlay
        previewLinks: false,

        // Transition style (none/fade/slide/convex/concave/zoom)
        transition: 'slide',

        // Transition speed (default/fast/slow)
        transitionSpeed: 'default',

        // Transition style for full page slide backgrounds
        // (none/fade/slide/convex/concave/zoom)
        backgroundTransition: 'fade',

        // Number of slides away from the current that are visible
        viewDistance: 3,

        // Number of slides away from the current that are visible on mobile
        // devices. It is advisable to set this to a lower number than
        // viewDistance in order to save resources.
        mobileViewDistance: 2,

        // The "normal" size of the presentation, aspect ratio will be preserved
        // when the presentation is scaled to fit different resolutions. Can be
        // specified using percentage units.
        width: 1280,

        height: 700,

        // Factor of the display size that should remain empty around the content
        margin: 0.1,

        // reveal.js plugins
        plugins: [QuartoLineHighlight, PdfExport, RevealMenu, RevealChalkboard, QuartoSupport,

          RevealNotes,
          RevealSearch,
          RevealZoom
        ]
      });
    </script>
    <div class="slide-footer">

        <img src="../qut_logo.jpg" alt="QUT Logo" class="qut-logo"> 

        <span class="course-code">

          <!-- <a href="../index.html">EGH445 Modern Control</a> -->

          EGH445 Modern Control

        </span>

      </div>
    <script>

    // custom.js

    

    // Variable to store the last seen H1 title (Section Title)

    let currentSectionTitle = "";

    // Variable to store the main Lecture Title (will be set on ready)

    let currentLectureTitle = "";

    // Variable to store the last seen H2 title (Slide Title)

    let currentSlideTitle = "";

    

    function updateHeaderContent(currentSlide) {

      let headerLeft = document.getElementById('header-left');

      let headerRight = document.getElementById('header-right');

      let subHeaderContainer = document.getElementById('sub-header-container');

      let subHeaderTitle = document.getElementById('sub-header-title');

    

      // --- Check for data-attributes first ---

      let slideDataHeaderLeft = currentSlide.dataset.headerLeft;

      let slideDataHeaderRight = currentSlide.dataset.headerRight;

    

      // --- Left Header (Lecture Title / Override) ---

      if (headerLeft) {

        if (slideDataHeaderLeft !== undefined) {

          // Use attribute value if present on the slide

          headerLeft.innerText = slideDataHeaderLeft;

        } else {

          // Otherwise, use the stored lecture title

          headerLeft.innerText = currentLectureTitle;

        }

      }

    

      // --- Right Header (Section Title / Override) ---

      let h1Element = currentSlide.querySelector('h1');

      let useH1Logic = true; // Flag to determine if we use H1 logic

    

      if (headerRight) {

        if (slideDataHeaderRight !== undefined) {

          // Use attribute value if present on the slide

          headerRight.innerText = slideDataHeaderRight;

          useH1Logic = false; // Don't use H1 logic if attribute is set

        }

      }

    

      // --- H1 Logic (Only if data-header-right wasn't used) ---

      if (useH1Logic) {

        if (h1Element) {

          // H1 FOUND (Section Title Slide)

          currentSectionTitle = h1Element.innerText.trim();

          if (headerRight) {

              headerRight.innerText = currentSectionTitle;

          }

          if (subHeaderContainer) {

              subHeaderContainer.style.display = 'none'; // Hide sub-header on H1 slides

          }

        } else {

          // NO H1 FOUND (Regular Slide)

           if (headerRight) {

              headerRight.innerText = currentSectionTitle; // Use stored section title

          }

          if (subHeaderContainer) {

              subHeaderContainer.style.display = 'block'; // Show sub-header on regular slides

          }

        }

      } else {

        // If data-header-right was used, decide sub-header visibility

        // Option 1: Hide sub-header if data-header-right is present

        if (subHeaderContainer) {

            subHeaderContainer.style.display = 'none';

        }

        // Option 2: Keep sub-header logic based on H1 presence (even if H1 text isn't used for headerRight)

        // if (h1Element && subHeaderContainer) { subHeaderContainer.style.display = 'none'; }

        // else if (subHeaderContainer) { subHeaderContainer.style.display = 'block'; }

      }

    

      // --- Sub-Header Title (H2) ---

      let h2Element = currentSlide.querySelector('h2');

      // Only update currentSlideTitle when an H2 is found AND has non-empty text

      if (h2Element && !currentSlide.classList.contains('title-slide-custom') && h2Element.innerText.trim() !== "") {

          currentSlideTitle = h2Element.innerText.trim(); // Store the H2 text when found

      }

      // Always apply the currentSlideTitle (whether it was just updated or is persisting from a previous slide)

      if (subHeaderTitle && currentSlideTitle !== "") {

        subHeaderTitle.innerText = currentSlideTitle;

      }

    }

    

    // --- Reveal.on('ready', ...) ---

    Reveal.on('ready', event => {

      let headerLeft = document.getElementById('header-left');

      let firstSlide = event.currentSlide;

      // Use H1 from .title-block on the *very first slide* to set the default lecture title

      let titleElement = document.querySelector('.reveal .slides section:first-of-type .title-block h1');

    

      if (titleElement) {

          currentLectureTitle = titleElement.innerText.trim();

      } else {

          // Fallback logic...

          let docTitle = document.title;

          if (docTitle && docTitle.includes('|')) {

            currentLectureTitle = docTitle.split('|')[0].trim();

          } else if (docTitle) {

            currentLectureTitle = docTitle.trim();

          } else {

            currentLectureTitle = "Lecture";

          }

      }

      

      // Initialize currentSlideTitle from the first slide if it has an H2 with non-empty text

      let firstH2 = firstSlide.querySelector('h2');

      if (firstH2 && !firstSlide.classList.contains('title-slide-custom') && firstH2.innerText.trim() !== "") {

        currentSlideTitle = firstH2.innerText.trim();

      }

    

      // --- Run initial update ---

      // This will now check attributes on the first slide

      updateHeaderContent(firstSlide);

    });

    

    // Add listener for when the slide changes

    Reveal.on('slidechanged', event => {

      updateHeaderContent(event.currentSlide);

    });

    

    // Add listener for when a fragment is shown

    Reveal.on('fragmentshown', event => {

      // event.fragment is the DOM element of the fragment that was shown

      let fragment = event.fragment;

    

      // Find the closest ancestor element with the class 'scrollable'

      let scrollableContainer = fragment.closest('.scrollable');

    

      // If the fragment is inside a .scrollable container

      if (scrollableContainer) {

        // Scroll the container to bring the fragment into view

        // Options like 'smooth', 'center' can be adjusted

        fragment.scrollIntoView({ behavior: 'smooth', block: 'nearest' });

      }

    });

    </script>
    <script id="quarto-html-after-body" type="application/javascript">
      window.document.addEventListener("DOMContentLoaded", function (event) {
        const tabsets =  window.document.querySelectorAll(".panel-tabset-tabby")
        tabsets.forEach(function(tabset) {
          const tabby = new Tabby('#' + tabset.id);
        });
        const isCodeAnnotation = (el) => {
          for (const clz of el.classList) {
            if (clz.startsWith('code-annotation-')) {                     
              return true;
            }
          }
          return false;
        }
        const onCopySuccess = function(e) {
          // button target
          const button = e.trigger;
          // don't keep focus
          button.blur();
          // flash "checked"
          button.classList.add('code-copy-button-checked');
          var currentTitle = button.getAttribute("title");
          button.setAttribute("title", "Copied!");
          let tooltip;
          if (window.bootstrap) {
            button.setAttribute("data-bs-toggle", "tooltip");
            button.setAttribute("data-bs-placement", "left");
            button.setAttribute("data-bs-title", "Copied!");
            tooltip = new bootstrap.Tooltip(button, 
              { trigger: "manual", 
                customClass: "code-copy-button-tooltip",
                offset: [0, -8]});
            tooltip.show();    
          }
          setTimeout(function() {
            if (tooltip) {
              tooltip.hide();
              button.removeAttribute("data-bs-title");
              button.removeAttribute("data-bs-toggle");
              button.removeAttribute("data-bs-placement");
            }
            button.setAttribute("title", currentTitle);
            button.classList.remove('code-copy-button-checked');
          }, 1000);
          // clear code selection
          e.clearSelection();
        }
        const getTextToCopy = function(trigger) {
            const codeEl = trigger.previousElementSibling.cloneNode(true);
            for (const childEl of codeEl.children) {
              if (isCodeAnnotation(childEl)) {
                childEl.remove();
              }
            }
            return codeEl.innerText;
        }
        const clipboard = new window.ClipboardJS('.code-copy-button:not([data-in-quarto-modal])', {
          text: getTextToCopy
        });
        clipboard.on('success', onCopySuccess);
        if (window.document.getElementById('quarto-embedded-source-code-modal')) {
          const clipboardModal = new window.ClipboardJS('.code-copy-button[data-in-quarto-modal]', {
            text: getTextToCopy,
            container: window.document.getElementById('quarto-embedded-source-code-modal')
          });
          clipboardModal.on('success', onCopySuccess);
        }
          var localhostRegex = new RegExp(/^(?:http|https):\/\/localhost\:?[0-9]*\//);
          var mailtoRegex = new RegExp(/^mailto:/);
            var filterRegex = new RegExp('/' + window.location.host + '/');
          var isInternal = (href) => {
              return filterRegex.test(href) || localhostRegex.test(href) || mailtoRegex.test(href);
          }
          // Inspect non-navigation links and adorn them if external
         var links = window.document.querySelectorAll('a[href]:not(.nav-link):not(.navbar-brand):not(.toc-action):not(.sidebar-link):not(.sidebar-item-toggle):not(.pagination-link):not(.no-external):not([aria-hidden]):not(.dropdown-item):not(.quarto-navigation-tool):not(.about-link)');
          for (var i=0; i<links.length; i++) {
            const link = links[i];
            if (!isInternal(link.href)) {
              // undo the damage that might have been done by quarto-nav.js in the case of
              // links that we want to consider external
              if (link.dataset.originalHref !== undefined) {
                link.href = link.dataset.originalHref;
              }
            }
          }
        function tippyHover(el, contentFn, onTriggerFn, onUntriggerFn) {
          const config = {
            allowHTML: true,
            maxWidth: 500,
            delay: 100,
            arrow: false,
            appendTo: function(el) {
                return el.closest('section.slide') || el.parentElement;
            },
            interactive: true,
            interactiveBorder: 10,
            theme: 'light-border',
            placement: 'bottom-start',
          };
          if (contentFn) {
            config.content = contentFn;
          }
          if (onTriggerFn) {
            config.onTrigger = onTriggerFn;
          }
          if (onUntriggerFn) {
            config.onUntrigger = onUntriggerFn;
          }
            config['offset'] = [0,0];
            config['maxWidth'] = 700;
          window.tippy(el, config); 
        }
        const noterefs = window.document.querySelectorAll('a[role="doc-noteref"]');
        for (var i=0; i<noterefs.length; i++) {
          const ref = noterefs[i];
          tippyHover(ref, function() {
            // use id or data attribute instead here
            let href = ref.getAttribute('data-footnote-href') || ref.getAttribute('href');
            try { href = new URL(href).hash; } catch {}
            const id = href.replace(/^#\/?/, "");
            const note = window.document.getElementById(id);
            if (note) {
              return note.innerHTML;
            } else {
              return "";
            }
          });
        }
        const findCites = (el) => {
          const parentEl = el.parentElement;
          if (parentEl) {
            const cites = parentEl.dataset.cites;
            if (cites) {
              return {
                el,
                cites: cites.split(' ')
              };
            } else {
              return findCites(el.parentElement)
            }
          } else {
            return undefined;
          }
        };
        var bibliorefs = window.document.querySelectorAll('a[role="doc-biblioref"]');
        for (var i=0; i<bibliorefs.length; i++) {
          const ref = bibliorefs[i];
          const citeInfo = findCites(ref);
          if (citeInfo) {
            tippyHover(citeInfo.el, function() {
              var popup = window.document.createElement('div');
              citeInfo.cites.forEach(function(cite) {
                var citeDiv = window.document.createElement('div');
                citeDiv.classList.add('hanging-indent');
                citeDiv.classList.add('csl-entry');
                var biblioDiv = window.document.getElementById('ref-' + cite);
                if (biblioDiv) {
                  citeDiv.innerHTML = biblioDiv.innerHTML;
                }
                popup.appendChild(citeDiv);
              });
              return popup.innerHTML;
            });
          }
        }
      });
      </script>
    

</body></html>